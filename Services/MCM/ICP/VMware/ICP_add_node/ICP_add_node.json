{
    "service": {
      "specVersion": "v3",
      "version": "3.2.1",
      "catalog_metadata": {
        "name": "ICP cluster add node",
        "description": "This service will add worker, proxy, and management nodes to your IBM Cloud Private cluster.\n\n",
        "image": "serviceicon_8.svg",
        "category": "Cluster Lifecycle Services",
        "bullets": [],
        "providerDisplayName": "IBM",
        "longDescription": "",
        "documentationUrl": "https://www.ibm.com/support/knowledgecenter/SS2L37_3.2.1.0/content/cam_content_overview_summary.html",
        "supportUrl": "https://www.ibm.com/support/knowledgecenter/SS2L37_3.2.1.0/cam_ordering_services.html",
        "bindable": false,
        "updatable": "",
        "systemTags": true,
        "author": "admin"
      },
      "tags": [
        {
          "name": "Request_Group",
          "label": "Request_Group",
          "type": "string",
          "immutable": true,
          "hidden": false,
          "required": false,
          "secured": false,
          "description": "The current context group id of the current user that requested the provisioning of the template. This is important because a user may be part of more than one group and this identifies the context of which group the user made the request.",
          "isSystemTag": true,
          "default": "${svc_instance.group}",
          "customtype": "string",
          "permission": "Read-Only"
        },
        {
          "name": "Request_User",
          "label": "Request_User",
          "type": "string",
          "immutable": true,
          "hidden": false,
          "required": false,
          "secured": false,
          "description": "The user id of the current user that requested the provisioning of the template.",
          "isSystemTag": true,
          "default": "${svc_instance.owner}",
          "customtype": "string",
          "permission": "Read-Only"
        },
        {
          "name": "Service_Name",
          "label": "Service_Name",
          "type": "string",
          "immutable": true,
          "hidden": false,
          "required": false,
          "secured": false,
          "description": "Name provided for the service instance by the end user at time of request",
          "isSystemTag": true,
          "default": "${svc_instance.name}",
          "customtype": "string",
          "permission": "Read-Only"
        },
        {
          "name": "Service_Identifier",
          "label": "Service_Identifier",
          "type": "string",
          "immutable": true,
          "hidden": false,
          "required": false,
          "secured": false,
          "description": "Unique identifer generated by ICAM which is mapped to the service instance of the template provisioned.",
          "isSystemTag": true,
          "default": "${svc_instance.service_instance_id}",
          "customtype": "string",
          "permission": "Read-Only"
        }
      ],
      "actions": [
        {
          "type": "provision",
          "name": "Provision",
          "description": "Default action for deployment of service",
          "input_parameters": [
            {
              "name": "cloud",
              "label": "cloud",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "options": [
                {
                  "value": "vmware",
                  "label": "vmware"
                },
                {
                  "value": "openstack",
                  "label": "openstack"
                }
              ]
            },
			{
				"name": "cloud_connection",
				"label": "Cloud Connection",
				"customtype": "string",
				"type": "connection",
				"provider": "VMware vSphere",
				"immutable": false,
				"hidden": true,
				"required": false,
				"secured": false,
				"description": "Name of cloud connection to use"
			},            
            {
              "name": "boot_vm_ipv4_address",
              "label": "Boot node IPv4 address",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "Boot node VM IPv4 address",
              "default": ""
            },
            {
              "name": "master_vm_ipv4_address",
              "label": "Master node IPv4 address",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "Master node VM IPv4 address",
              "default": ""
            },
            {
              "name": "icp_version",
              "label": "ICP version",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": true,
              "required": true,
              "secured": false,
              "description": "ICP version",
              "default": "3.2.1"
            },
            {
              "name": "cluster_location",
              "label": "ICP cluster location",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "ICP cluster folder location",
              "default": "/root/ibm-cloud-private-x86_64-3.2.0/cluster"
            },
            {
              "name": "node_type",
              "label": "ICP cluster node type",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "which type of node you like to add to cluster",
              "options": [
                {
                  "label": "Management",
                  "value": "Management",
                  "default": false
                },
                {
                  "label": "Proxy (HA only)",
                  "value": "Proxy (HA only)",
                  "default": false
                },
                {
                  "label": "Worker",
                  "value": "Worker",
                  "default": true
                },
                {
                  "label": "Vulnerability Advisor (VA)",
                  "value": "Vulnerability Advisor (VA)",
                  "default": false
                }
              ]
            },
            {
              "name": "vm_domain",
              "label": "Domain",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "network domain",
              "default": ""
            },            
            {
              "name": "vm_os_user",
              "label": "Root user",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "OS root user",
              "default": "root"
            },
            {
              "name": "vm_os_password",
              "label": "Root password",
              "customtype": "password",
              "type": "password",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "Root OS password",
              "default": ""
            },
            {
              "name": "worker_hostname_ip",
              "label": "Node Hostname and IPv4 address",
              "customtype": "map",
              "type": "map",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "Node VM Hostname and IPv4 address",
              "default": {
                "Hostname": "0.0.0.0"
              }
            },
            {
              "name": "worker_memory",
              "label": "Node memory",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "New Node memory",
              "default": "16384"
            },
            {
              "name": "worker_vcpu",
              "label": "Node vCPU",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "New node vCPU",
              "default": "16"
            },
            {
              "name": "worker_vm_disk1_size",
              "label": "Node disk1 size",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "New node disk1 size",
              "default": "200"
            },
            {
              "name": "worker_enable_glusterFS",
              "label": "Enable GlusterFS",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "Enable GlusterFS only for worker node",
              "options": [
                {
                  "label": "True",
                  "value": "true",
                  "default": false
                },
                {
                  "label": "False",
                  "value": "false",
                  "default": false
                }
              ]
            },
            {
              "name": "worker_vm_disk2_size",
              "label": "Node disk2 size",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "New node disk2 size, require for glusterFS",
              "default": ""
            },
            {
              "name": "vm_security_groups",
              "label": "Security groups",
              "customtype": "list",
              "type": "list",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "Openstack Security groups",
              "default": [
                ""
              ]
            },
            {
              "name": "vm_public_ip_pool",
              "label": "Public IPv4 pool",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": true,
              "secured": false,
              "description": "Openstack Public IPv4 pool",
              "default": ""
            },
            {
              "name": "vm_image_id",
              "label": "Image ID",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "Image id of OS to deploy",
              "default": ""
            },
            {
              "name": "worker_vm_flavor_id",
              "label": "VM flavour id",
              "customtype": "string",
              "type": "string",
              "immutable": false,
              "hidden": false,
              "required": false,
              "secured": false,
              "description": "VM flavour id",
              "default": ""
            }
          ],
          "flow": {
            "conditions": [
              {
                "decision": {
                  "title": "Cloud",
                  "options": [
                    {
                      "case": "vmware",
                      "sequence": {
                        "0": "ibmcloud15d1eb15"
                      }
                    },
                    {
                      "case": "openstack",
                      "sequence": {
                        "0": "ibmcloud77d1fdd2"
                      }
                    }
                  ],
                  "id": "decision9571ce67",
                  "mapped_parameter": "${input_parameters.cloud}"
                }
              }
            ],
            "templates": [
              {
                "IBM Cloud Private Node": {
                  "title": "IBM Cloud Private Node_0216f1",
                  "template_name": "IBM Cloud Private Node",
                  "version": "3.2.1",
                  "id": "ibmcloud15d1eb15",
                  "template_type": "Terraform",
                  "template_content_type": "VMware vSphere",
                  "template_provider": "VMware vSphere",
                  "instance_name": "",
                  "cloud_connection_name": "${input_parameters.cloud_connection}",
                  "template_data_objects": {
                    "bastionhost": "DefaultNoBastionHostRequired"
                  },
                  "template_params": {
                    "boot_vm_ipv4_address": "${input_parameters.boot_vm_ipv4_address}",
                    "master_vm_ipv4_address": "${input_parameters.master_vm_ipv4_address}",
                    "icp_version": "${input_parameters.icp_version}",
                    "cluster_location": "${input_parameters.cluster_location}",
                    "node_type": "${input_parameters.node_type}",
					"vm_dns_servers": "${datatypes.vsphere_managed_inventory_definition.dns_servers}",
					"vm_dns_suffixes": "${datatypes.vsphere_managed_inventory_definition.dns_suffixes}",
					"vsphere_datacenter": "${datatypes.vsphere_managed_inventory_definition.datacenter}",
					"vsphere_resource_pool": "${datatypes.vsphere_managed_inventory_definition.resource_pool}",
					"vm_network_interface_label": "${datatypes.vsphere_managed_inventory_definition.network}",
					"vm_folder": "${datatypes.vsphere_managed_inventory_definition.vm_folder}",                    
                    "vm_domain": "${input_parameters.vm_domain}",
                    "vm_disk1_datastore": "${datatypes.vsphere_managed_inventory_definition.datastore}",
                    "vm_disk2_datastore": "${datatypes.vsphere_managed_inventory_definition.datastore}",
                    "vm_template": "${datatypes.vsphere_managed_inventory_definition.vm_image_template}",
                    "vm_os_user": "${input_parameters.vm_os_user}",
                    "vm_os_password": "${input_parameters.vm_os_password}",
                    "vm_clone_timeout": "30",
                    "worker_hostname_ip": "${input_parameters.worker_hostname_ip}",
                    "worker_memory": "${input_parameters.worker_memory}",
                    "worker_vcpu": "${input_parameters.worker_vcpu}",
                    "worker_vm_disk1_size": "${input_parameters.worker_vm_disk1_size}",
                    "worker_enable_glusterFS": "${input_parameters.worker_enable_glusterFS}",
                    "worker_vm_disk2_size": "${input_parameters.worker_vm_disk2_size}",
                    "worker_vm_ipv4_gateway": "${datatypes.vsphere_managed_inventory_definition.vm_ipv4_gateway}",
                    "worker_vm_ipv4_prefix_length": "${datatypes.vsphere_managed_inventory_definition.vm_ipv4_netmask}"
                  },
                  "outputs": [
                    "ibm_cloud_private_master_ip"
                  ]
                }
              },
              {
                "IBM Cloud Private Node on OpenStack": {
                  "title": "IBM Cloud Private Node on OpenStack_6d5189",
                  "template_name": "IBM Cloud Private Node on OpenStack",
                  "version": "3.2.1",
                  "id": "ibmcloud77d1fdd2",
                  "template_type": "Terraform",
                  "template_content_type": "OpenStack",
                  "template_provider": "OpenStack",
                  "instance_name": "",
                  "cloud_connection_name": "${input_parameters.cloud_connection}",
                  "template_data_objects": {
                    "bastionhost": "DefaultNoBastionHostRequired"
                  },
                  "template_params": {
                    "boot_vm_ipv4_address": "${input_parameters.boot_vm_ipv4_address}",
                    "master_vm_ipv4_address": "${input_parameters.master_vm_ipv4_address}",
                    "icp_version": "${input_parameters.icp_version}",
                    "cluster_location": "${input_parameters.cluster_location}",
                    "node_type": "${input_parameters.node_type}",
                    "vm_security_groups": "${input_parameters.vm_security_groups}",
                    "vm_public_ip_pool": "${input_parameters.vm_public_ip_pool}",
                    "vm_domain": "${input_parameters.vm_domain}",
                    "vm_image_id": "${input_parameters.vm_image_id}",
                    "vm_os_user": "${input_parameters.vm_os_user}",
                    "vm_os_password": "${input_parameters.vm_os_password}",
                    "worker_hostname_ip": "${input_parameters.worker_hostname_ip}",
                    "worker_vm_flavor_id": "${input_parameters.worker_vm_flavor_id}",
                    "worker_vm_disk1_size": "${input_parameters.worker_vm_disk1_size}",
                    "worker_enable_glusterFS": "${input_parameters.worker_enable_glusterFS}",
                    "worker_vm_disk2_size": "${input_parameters.worker_vm_disk2_size}"
                  },
                  "outputs": [
                    "ibm_cloud_private_master_ip"
                  ]
                }
              }
            ],
            "resthooks": [],
            "notifications": [],
            "sequence": {
              "0": "decision9571ce67"
            },
            "error_sequence": {}
          },
          "output_parameters": []
        }
      ],
      "plans": [
        {
          "name": "VMware",
          "description": "Deploy new node on VMware cloud",
          "actions": [],
          "plan_parameters": [
            {
              "name": "cloud",
              "label": "cloud",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": true,
              "secured": false,
              "default": "vmware"
            },
			{
				"name": "cloud_connection",
				"label": "Cloud Connection",
				"customtype": "string",
				"type": "connection",
				"provider": "VMware vSphere",
				"immutable": false,
				"hidden": false,
				"required": false,
				"secured": false,
				"description": "Name of cloud connection to use"
			},            
			{
				"name": "vsphere_managed_inventory_definition",
				"label": "vSphere Managed Inventory Definition",
				"customtype": "sharedparameter",
				"type": "sharedparameter",
				"immutable": false,
				"hidden": false,
				"required": true,
				"secured": false,
				"description": "vSphere Managed Inventory Objects that are used in virtual machine creation.",
				"default": "",
				"datatype": "vsphere_managed_inventory_definition"
			},            
            {
              "name": "vm_security_groups",
              "label": "Security groups",
              "customtype": "list",
              "type": "list",
              "immutable": true,
              "hidden": true,
              "required": false,
              "secured": false,
              "description": "Openstack Security groups",
              "default": [
                "sec group"
              ]
            },
            {
              "name": "vm_public_ip_pool",
              "label": "Public IPv4 pool",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": true,
              "secured": false,
              "description": "Openstack Public IPv4 pool",
              "default": "ip pool"
            },
            {
              "name": "vm_image_id",
              "label": "Image ID",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": false,
              "secured": false,
              "description": "Image id of OS to deploy",
              "default": "image id"
            },
            {
              "name": "worker_vm_flavor_id",
              "label": "VM flavour id",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": false,
              "secured": false,
              "description": "VM flavour id",
              "default": "flavour"
            }
          ],
          "expanded": false
        },
        {
          "name": "Openstck",
          "description": "Deploy new node on openstavk",
          "plan_parameters": [
            {
              "name": "cloud",
              "label": "cloud",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": true,
              "secured": false,
              "default": "openstack"
            },
			{
				"name": "cloud_connection",
				"label": "Cloud Connection",
				"customtype": "string",
				"type": "connection",
				"provider": "OpenStack",
				"immutable": false,
				"hidden": false,
				"required": false,
				"secured": false,
				"description": "Name of cloud connection to use"
			},            
            {
              "name": "worker_memory",
              "label": "Node memory",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": true,
              "secured": false,
              "description": "New Node memory",
              "default": "16384"
            },
            {
              "name": "worker_vcpu",
              "label": "Node vCPU",
              "customtype": "string",
              "type": "string",
              "immutable": true,
              "hidden": true,
              "required": true,
              "secured": false,
              "description": "New node vCPU",
              "default": "16"
            }
          ]
        }
      ]
    }
  }

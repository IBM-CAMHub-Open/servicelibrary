{
  "service": {
    "specVersion": "v3",
    "version": "2.1.0.1",
    "catalog_metadata": {
      "name": "Service Now CMDB add and Delete record",
      "description": "This service is used to deploy a VM on a cloud with middleware software installed.It will also perform an update in CMDB.",
      "image": "serviceicon_1.svg",
      "category": "Application Services",
      "bullets": [
        {
          "title": "IPAM Server",
          "description": "Gat an available ip from IPAM server"
        },
        {
          "title": "IBM WebSphere Network Deployment",
          "description": "IBM WebSphere Network Deployment V9 on a single virtual machine using IPAM server output"
        }
      ],
      "providerDisplayName": "IBM",
      "longDescription": "This service is used to deploy a VM on a cloud with middleware software installed.As per user selection application will get deployed and CMDB will get updated with server records.",
      "documentationUrl": "",
      "supportUrl": "",
      "bindable": false,
      "updatable": "",
      "author": "admin"
    },
    "tags": [
      {
        "name": "environment",
        "label": "Environment",
        "type": "string",
        "immutable": false,
        "hidden": false,
        "required": true,
        "secured": false,
        "description": "Unique identifer added to the provisioned VMs.",
        "isSystemTag": true,
        "customtype": "string",
        "permission": "Read-Write",
        "options": [
          {
            "label": "Development",
            "value": "dev",
            "default": true
          },
          {
            "label": "Quality Assurance",
            "value": "qa",
            "default": false
          },
          {
            "label": "Production",
            "value": "prod",
            "default": false
          },
          {
            "label": "Test",
            "value": "test",
            "default": false
          }
        ]
      },
      {
        "name": "request_group",
        "label": "request_group",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "The current context group id of the current user that requested the provisioning of the template. This is important because a user may be part of more than one group and this identifies the context of which group the user made the request.",
        "isSystemTag": true,
        "customtype": "string",
        "permission": "Read-Only",
        "default": "${svc_instance.group}"
      },
      {
        "name": "request_user",
        "label": "request_user",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "The user id of the current user that requested the provisioning of the template.",
        "isSystemTag": true,
        "customtype": "string",
        "permission": "Read-Only",
        "default": "${svc_instance.owner}"
      },
      {
        "name": "service_name",
        "label": "service_name",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "Name provided for the service instance by the end user at time of request",
        "isSystemTag": true,
        "customtype": "string",
        "permission": "Read-Only",
        "default": "${svc_instance.name}"
      },
      {
        "name": "service_identifier",
        "label": "service_identifier",
        "type": "string",
        "immutable": true,
        "hidden": false,
        "required": false,
        "secured": false,
        "description": "Unique identifer generated by ICAM which is mapped to the service instance of the template provisioned.",
        "isSystemTag": true,
        "customtype": "string",
        "permission": "Read-Only",
        "default": "${svc_instance.service_instance_id}"
      }    
    ],
    "actions": [
      {
        "type": "provision",
        "name": "Provision",
        "description": "Default action for deployment of service",
        "input_parameters": [
          {
            "name": "Environment",
            "label": "Environment",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "options": [
              {
                "value": "Development",
                "label": "Development"
              },
              {
                "value": "Test",
                "label": "Test"
              },
              {
                "value": "Production",
                "label": "Production"
              }
            ]
          },
          {
            "name": "vmware_cloud_connection",
            "label": "VMware Cloud Connection Name",
            "customtype": "connection",
            "type": "connection",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Name of the VMware cloud connection used to deploy WebSphere Application Server",
            "provider": "VMware vSphere",
            "default": ""
          },         
          {
            "name": "infoblox",
            "label": "Infoblox IPAM Server",
            "customtype": "sharedparameter",
            "type": "sharedparameter",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Describes an Infoblox IPAM server and a specific network the system request next available IP address.",
            "default": "",
            "datatype": "infoblox"
          },          
    	  {
      		"name": "infoblox_hostname",
      		"description": "The hostname to associate with the requested IP address from infoblox.",
      		"type": "string",
      		"required": true,
      		"secured": false,
      		"label": "Host Name for IP address from infoblox.",
      		"hidden": false,
		    "immutable": false
          },        
          {
            "name": "WASNode01-image",
            "label": "WAS image",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "WAS Node image",
            "default": "terraform/template/UbantuDockerCE"
          },
    	  {
      		"name": "WASNode01_dns_servers",
      		"type": "list",
      		"description": "DNS servers for the WAS node virtual network adapter",
      		"hidden": false,
      		"label": "WAS Node DNS Servers",
      		"secured": false,
      		"required": true,
      		"immutable": false
    	  },
    	  {
      		"name": "WASNode01_dns_suffixes",
      		"type": "list",
      		"description": "Name resolution suffixes for the WAS node virtual network adapter",
      		"hidden": false,
      		"label": "WAS Node DNS Suffixes",
      		"secured": false,
      		"required": true,
      		"immutable": false
    	  },          
    	  {
      		"name": "WASNode01_domain",
      		"type": "string",
      		"description": "Domain Name of WAS virtual machine",
      		"hidden": false,
      		"label": "WAS Node Domain Name",
      		"secured": false,
      		"required": true,
      		"immutable": false
    	  },          
          {
            "name": "WASNode01-os_admin_user",
            "label": "WAS Node OS admin user",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "WAS Node OS admin user",
            "default": "root"
          },
          {
            "name": "WASNode01-os_password",
            "label": "WAS Node OS admin password",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "WAS Node OS admin password",
            "default": ""
          },
          {
            "name": "user_public_ssh_key",
            "label": "WAS node public ssh key",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "WAS node public ssh key",
            "default": ""
          },
          {
            "name": "WASNode01_root_disk_size",
            "label": "WAS node root disk size",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "WAS node root disk size",
            "default": ""
          },
          {
            "name": "WASNode01-name",
            "label": "Short hostname of WAS virtual machine",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": false,
            "secured": false,
            "description": "Short hostname of WAS virtual machine",
            "default": ""
          },
          {
            "name": "WASNode01_root_disk_datastore",
      		"description": "Data store or storage cluster name for target virtual machine's disks",
		    "label": "Template Disk Datastore for WAS Node",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "default": ""
          },
          {
            "name": "WASNode01_memory",
            "label": "Memory for WAS Node",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Memory for WAS Node",
            "default": ""
          },
          {
            "name": "WASNode01_ipv4_prefix_length",
            "label": "IP address for WAS Node",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "IP address for WAS Node",
            "default": ""
          },
          {
            "name": "WASNode01_network_interface_label",
            "label": "Network label for WAS Node",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Network label for WAS Node",
            "default": ""
          },
          {
            "name": "WASNode01_was_security_admin_user_pwd",
            "description": "The password for the WebSphere administrative account",
            "label": "WebSphere administrative user password - WASNode01",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "default": ""
          },
          {
            "name": "WASNode01_cluster",
            "label": "vSphere Cluster to host WAS Node",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Target vSphere cluster to host the virtual machine",
            "default": ""
          },
          {
            "name": "WASNode01_datacenter",
            "label": "vSphere datacenter to host WAS Node",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Target vSphere datacenter for virtual machine creation",
            "default": ""
          },
          {
            "name": "WASNode01_folder",
            "label": "vSphere folder for WAS virtual machine",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Target vSphere folder for virtual machine",
            "default": ""
          },
          {
            "name": "subject",
            "label": "Email subject",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Email subject"
          },
          {
            "name": "to",
            "label": "Email to",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Email to"
          },
          {
            "name": "content",
            "label": "Email Content",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Email Content"
          },
          {
            "name": "ipv4_address",
            "label": "ELK ipv4 address",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "ELK ipv4 address",
            "default": ""
          },
          {
            "name": "elk_os_admin_user",
            "label": "ELK OS admin user",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "ELK OS admin user",
            "default": ""
          },
          {
            "name": "elk_os_admin_password",
            "label": "ELK OS admin user password",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "ELK OS admin user password",
            "default": ""
          },
          {
            "name": "elk_os_private_ssh_key",
            "label": "ELK OS user SSH key",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "ELK OS user SSH key",
            "default": ""
          },
          {
            "name": "elk_logstash_server_ip",
            "label": "ELK logstash server IP",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "ELK logstash server IP",
            "default": ""
          },
          {
            "name": "logstash_server_port",
            "label": "ELK logstash server port",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": false,
            "secured": false,
            "description": "ELK logstash server port",
            "default": ""
          },
          {
            "name": "filebeat_source_url",
            "label": "Filebeat package location",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "HTTP URL of the filebeat installation package.",
            "default": ""
          },
          {
            "name": "monitored_paths",
            "description": "List of files and directories to monitor with logstash. One of Filebeat package location and Monitored paths needs to be specified.",
            "label": "Monitored paths",
            "customtype": "list",
            "type": "list",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "default": [
              ""
            ]
          },
          {
            "name": "filebeat_config_url",
            "label": "Filebeat config file location",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "HTTP URL of the filebeat configuration file. One of Filebeat package location and Monitored paths needs to be specified. Example file names, filebeat-6.2.2-amd64.deb  or filebeat-6.2.2-x86_64.rpm.",
            "default": ""
          },
          {
            "name": "apm_ip_address",
            "label": "APM IP address",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "IP Address of the HOST to install the APM Agent.",
            "default": ""
          },
          {
            "name": "apm_user",
            "label": "APM operating system user",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Userid to install the APM Agent, root reccomended.",
            "default": ""
          },
          {
            "name": "apm_password",
            "label": "APM password",
            "customtype": "password",
            "type": "password",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Password of the installation user.",
            "default": ""
          },
          {
            "name": "apm_private_key",
            "label": "APM user private key",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": false,
            "secured": false,
            "description": "APM operating system private key",
            "default": ""
          },
          {
            "name": "apm_location",
            "label": "APM agent source location",
            "customtype": "string",
            "type": "string",
            "immutable": false,
            "hidden": false,
            "required": true,
            "secured": false,
            "description": "Source for the APM Agent installer, eg http://IP_ADDRESS:8888/apm-agent/APMADV_Agent_Install.tar",
            "default": ""
          }
        ],
        "flow": {
          "conditions": [
            {
              "decision": {
                "title": "Environment",
                "options": [
                  {
                    "case": "Development",
                    "sequence": {}
                  },
                  {
                    "case": "Test",
                    "sequence": {
                      "0": "elkagent0b3d18c6"
                    }
                  },
                  {
                    "case": "Production",
                    "sequence": {
                      "0": "elkagent165c4d3f",
                      "1": "apmagente04de514"
                    }
                  }
                ],
                "id": "decision5d392e66",
                "description": "Environment",
                "mapped_parameter": "${input_parameters.Environment}"
              }
            }
          ],
          "templates": [
            {
              "Infoblox Integration Template": {
                "title": "Infoblox Integration Template_b22b74",
                "template_name": "Infoblox Integration Template",
                "version": "2.1",
                "id": "infoblox02585faa",
                "template_type": "Terraform",
                "template_content_type": "Integration",
                "template_provider": "Other",
                "instance_name": "",
                "cloud_connection_name": "Other",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired",
                  "infoblox": "${input_parameters.infoblox}"
                },
                "template_params": {
                  "hostname": "${input_parameters.infoblox_hostname}",
                  "domain": "${infoblox.domain}",
                  "configure_for_dns": "${infoblox.configure_for_dns}",
                  "infoblox_ip_address": "${infoblox.infoblox_ip_address}",
                  "infoblox_user": "${infoblox.infoblox_user}",
                  "infoblox_user_password": "${infoblox.infoblox_user_password}",
                  "network": "${infoblox.network}"
                },
                "outputs": [
                  "assigned_ip_address",
                  "associated_domain",
                  "associated_hostname"
                ],
                "provider_engine_version": "0.11.11"
              }
            },
            {
              "IBM WebSphere Network Deployment V9 on a single virtual machine": {
                "title": "IBM WebSphere Network Deployment V9 on a single virtual machine_44425c",
                "template_name": "IBM WebSphere Network Deployment V9 on a single virtual machine - VMware vSphere",
                "version": "2.1",
                "id": "ibmwebspcb078873",
                "template_type": "Terraform",
                "template_content_type": "VMware vSphere",
                "template_provider": "VMware vSphere",
                "instance_name": "",
                "cloud_connection_name": "${input_parameters.vmware_cloud_connection}",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired",
                  "httpproxy": "DefaultNoProxyRequired",
                  "advanced_content_runtime_chef": "VMware"
                },
                "template_params": {
                  "WASNode01_dns_servers": [
                    "${input_parameters.WASNode01_dns_servers}"
                  ],
                  "WASNode01_dns_suffixes": [
                    "${input_parameters.WASNode01_dns_suffixes}"
                  ],
                  "WASNode01_domain": "${input_parameters.WASNode01_domain}",
                  "WASNode01-image": "${input_parameters.WASNode01-image}",
                  "WASNode01-os_admin_user": "${input_parameters.WASNode01-os_admin_user}",
                  "WASNode01-os_password": "${input_parameters.WASNode01-os_password}",
                  "user_public_ssh_key": "${input_parameters.user_public_ssh_key}",
                  "WASNode01_root_disk_size": "${input_parameters.WASNode01_root_disk_size}",
                  "WASNode01-name": "${input_parameters.WASNode01-name}",
                  "WASNode01_root_disk_datastore": "${input_parameters.WASNode01_root_disk_datastore}",
                  "WASNode01_ipv4_gateway": "${input_parameters.WASNode01_root_disk_datastore}",
                  "WASNode01_ipv4_address": "${templates.infoblox02585faa.output.assigned_ip_address}",
                  "WASNode01_memory": "${input_parameters.WASNode01_memory}",
                  "WASNode01_ipv4_prefix_length": "${input_parameters.WASNode01_ipv4_prefix_length}",
                  "WASNode01_number_of_vcpu": "${input_parameters.WASNode01_ipv4_prefix_length}",
                  "WASNode01_network_interface_label": "${input_parameters.WASNode01_network_interface_label}",
                  "WASNode01_was_version": "9.0.0.8",
                  "WASNode01_was_profiles_standalone_profiles_standalone1_cell": "cell01",
                  "WASNode01_was_wsadmin_standalone_jvmproperty_property_value_maximum": "512",
                  "WASNode01_was_wsadmin_standalone_jvmproperty_property_value_initial": "256",
                  "WASNode01_was_profiles_standalone_profiles_standalone1_profile": "AppSrv01",
                  "WASNode01_was_java_version": "8.0.5.17",
                  "WASNode01_was_security_admin_user": "wasadmin",
                  "WASNode01_was_security_admin_user_pwd": "${input_parameters.WASNode01_was_security_admin_user_pwd}",
                  "WASNode01_was_profiles_standalone_profiles_standalone1_keystorepassword": "${input_parameters.WASNode01_was_security_admin_user_pwd}",
                  "WASNode01_was_os_users_was_name": "wasadmin",
                  "WASNode01_was_install_dir": "/opt/IBM/WebSphere/AppServer",
                  "WASNode01_was_profile_dir": "/opt/IBM/WebSphere/AppServer/profiles",
                  "WASNode01_was_os_users_was_gid": "wasgrp",
                  "WASNode01_cluster": "${input_parameters.WASNode01_cluster}",
                  "WASNode01_datacenter": "${input_parameters.WASNode01_datacenter}",
                  "WASNode01_folder": "${input_parameters.WASNode01_folder}",
                  "WASNode01_adapter_type": "vmxnet3",
                  "WASNode01_resource_pool": "${input_parameters.WASNode01_folder}"
                },
                "outputs": [
                  "WASNode01_ip",
                  "WASNode01_name",
                  "WASNode01_roles",
                  "stack_id"
                ],
                "provider_engine_version": "0.11.11"
              }
            },
            {
              "ELK Agent Installation Template": {
                "title": "Test_ELK Agent Installation Template_81de3d",
                "template_name": "ELK Agent Installation Template",
                "version": "2.1",
                "id": "elkagent0b3d18c6",
                "template_type": "Terraform",
                "template_content_type": "Integration",
                "template_provider": "Other",
                "instance_name": "",
                "cloud_connection_name": "Other",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "ipv4_address": "${input_parameters.ipv4_address}",
                  "os_admin_user": "${input_parameters.elk_os_admin_user}",
                  "os_admin_password": "${input_parameters.elk_os_admin_password}",
                  "os_private_ssh_key": "${input_parameters.elk_os_private_ssh_key}",
                  "logstash_server_ip": "${input_parameters.elk_logstash_server_ip}",
                  "logstash_server_port": "${input_parameters.logstash_server_port}",
                  "filebeat_source_url": "${input_parameters.filebeat_source_url}",
                  "filebeat_config_url": "${input_parameters.filebeat_config_url}",
                  "monitored_paths": "${input_parameters.monitored_paths}"
                },
                "outputs": [],
                "provider_engine_version": "0.11.11"
              }
            },
            {
              "ELK Agent Installation Template": {
                "title": "Prod_ELK Agent Installation Template_81de3d",
                "template_name": "ELK Agent Installation Template",
                "version": "2.1",
                "id": "elkagent165c4d3f",
                "template_type": "Terraform",
                "template_content_type": "Integration",
                "template_provider": "Other",
                "instance_name": "",
                "cloud_connection_name": "Other",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "ipv4_address": "${input_parameters.ipv4_address}",
                  "os_admin_user": "${input_parameters.elk_os_admin_user}",
                  "os_admin_password": "${input_parameters.elk_os_admin_password}",
                  "os_private_ssh_key": "${input_parameters.elk_os_private_ssh_key}",
                  "logstash_server_ip": "${input_parameters.elk_logstash_server_ip}",
                  "logstash_server_port": "${input_parameters.logstash_server_port}",
                  "filebeat_source_url": "${input_parameters.filebeat_source_url}",
                  "filebeat_config_url": "${input_parameters.filebeat_config_url}",
                  "monitored_paths": "${input_parameters.monitored_paths}"
                },
                "outputs": [],
                "provider_engine_version": "0.11.11"
              }
            },
            {
              "APM Agent Installation Template": {
                "title": "APM Agent Installation Template_0dca44",
                "template_name": "APM Agent Installation Template",
                "version": "2.1",
                "id": "apmagente04de514",
                "template_type": "Terraform",
                "template_content_type": "Integration",
                "template_provider": "Other",
                "instance_name": "",
                "cloud_connection_name": "Other",
                "template_data_objects": {
                  "bastionhost": "DefaultNoBastionHostRequired"
                },
                "template_params": {
                  "ip_address": "${input_parameters.apm_ip_address}",
                  "user": "${input_parameters.apm_user}",
                  "password": "${input_parameters.apm_password}",
                  "private_key": "${input_parameters.apm_private_key}",
                  "apm_location": "${input_parameters.apm_location}",
                  "apm_method": "http",
                  "apm_source_subdir": "APMADV_Agent_Install_8.1.4.0.1",
                  "apm_dir": "/opt/ibm/apm/agent",
                  "apm_agents": "os"
                },
                "outputs": [],
                "provider_engine_version": "0.11.11"
              }
            }
          ],
          "resthooks": [],
          "notifications": [
            {
              "emailnotification": {
                "title": "emailnotification_484bdc",
                "type": "email",
                "receiverList": "${input_parameters.to}",
                "id": "emailnot3124a5e9",
                "sender": "CAMadmin",
                "copyToList": "",
                "subject": "${input_parameters.subject}",
                "body": "${input_parameters.content}"
              }
            }
          ],
          "sequence": {
            "0": "infoblox02585faa",
            "1": "ibmwebspcb078873",
            "2": "decision5d392e66",
            "3": "emailnot3124a5e9"
          }
        },
        "output_parameters": []
      }
    ],
    "plans": [
      {
        "name": "Standard",
        "description": "To deploy a Standard plan",
        "actions": [],
        "plan_parameters": []
      }
    ]
  }
}
